
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module Separation</title>
<meta name="description" content="Documentation of Coq module Separation" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module Separation</h1>
<div class="coq">
<div class="doc">Heaps and heap assertions for separation logics. </div>
<br/>
<span class="id">From</span> <span class="id">Coq</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.ZArith.html">ZArith</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.micromega.Lia.html">Lia</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Bool.Bool.html">Bool</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Strings.String.html">String</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Lists.List.html">List</a></span>.<br/>
<span class="id">From</span> <span class="id">Coq</span> <span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.FunctionalExtensionality.html">FunctionalExtensionality</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.PropExtensionality.html">PropExtensionality</a></span>.<br/>
<br/>
<span class="kwd">Local</span> <span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">Z_scope</span>.<br/>
<br/>
<h1> 1. Memory heaps </h1>
<br/>
<div class="doc">A memory heap is a partial function from addresses (memory locations) 
    to values, with a finite domain. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="addr">addr</a></span> := <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>.<br/>
<br/>
<span class="kwd">Record</span> <span class="id"><a name="heap">heap</a></span> : <span class="kwd">Type</span> := {<br/>
&nbsp;&nbsp;<span class="id"><a name="contents">contents</a></span> :&gt; <span class="id"><a href="CDF.Separation.html#addr">addr</a></span> -&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#option">option</a></span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>;<br/>
&nbsp;&nbsp;<span class="id"><a name="isfinite">isfinite</a></span> :  <span class="id">exists</span> <span class="id">i</span>, <span class="kwd">forall</span> <span class="id">j</span>, <span class="id">i</span> &lt;= <span class="id">j</span> -&gt; <span class="id">contents</span> <span class="id">j</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span><br/>
}.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="heap_extensionality">heap_extensionality</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">h1</span> <span class="id">h2</span>: <span class="id"><a href="CDF.Separation.html#heap">heap</a></span>),<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">l</span>, <span class="id">h1</span> <span class="id">l</span> = <span class="id">h2</span> <span class="id">l</span>) -&gt; <span class="id">h1</span> = <span class="id">h2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof113')">Proof.</div>
<div class="proofscript" id="proof113">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">h1</span> <span class="kwd">as</span> [<span class="id">c1</span> <span class="id">fin1</span>], <span class="id">h2</span> <span class="kwd">as</span> [<span class="id">c2</span> <span class="id">fin2</span>].<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">c1</span> = <span class="id">c2</span>) <span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.FunctionalExtensionality.html#functional_extensionality">functional_extensionality</a></span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">c2</span>. <span class="tactic">f_equal</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.PropExtensionality.html#proof_irrelevance">proof_irrelevance</a></span>.<br/>
Qed.</div>
<br/>
<div class="doc">The empty heap. </div>
<br/>
<span class="kwd">Program</span> <span class="kwd">Definition</span> <span class="id"><a name="hempty">hempty</a></span> : <span class="id"><a href="CDF.Separation.html#heap">heap</a></span> :=<br/>
&nbsp;&nbsp;{| <span class="id"><a href="CDF.Separation.html#contents">contents</a></span> := <span class="kwd">fun</span> <span class="id">l</span> =&gt; <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> |}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof114')">Next Obligation.</div>
<div class="proofscript" id="proof114">
&nbsp;&nbsp;<span class="id">exists</span> 0; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">The heap that contains <span class="bracket"><span class="id">v</span></span> at address <span class="bracket"><span class="id">l</span></span> and is equal to <span class="bracket"><span class="id">h</span></span> on
    all other addresses. </div>
<br/>
<span class="kwd">Program</span> <span class="kwd">Definition</span> <span class="id"><a name="hupdate">hupdate</a></span> (<span class="id">l</span>: <span class="id"><a href="CDF.Separation.html#addr">addr</a></span>) (<span class="id">v</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) (<span class="id">h</span>: <span class="id"><a href="CDF.Separation.html#heap">heap</a></span>) : <span class="id"><a href="CDF.Separation.html#heap">heap</a></span> :=<br/>
&nbsp;&nbsp;{| <span class="id"><a href="CDF.Separation.html#contents">contents</a></span> := <span class="kwd">fun</span> <span class="id">l</span>' =&gt; <span class="kwd">if</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.eq_dec">Z.eq_dec</a></span> <span class="id">l</span> <span class="id">l</span>' <span class="kwd">then</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span> <span class="kwd">else</span> <span class="id">h</span> <span class="id">l</span>' |}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof115')">Next Obligation.</div>
<div class="proofscript" id="proof115">
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CDF.Separation.html#isfinite">isfinite</a></span> <span class="id">h</span>) <span class="kwd">as</span> (<span class="id">i</span> &amp; <span class="id">fin</span>).<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.max">Z.max</a></span> <span class="id">i</span> (<span class="id">l</span> + 1)); <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.eq_dec">Z.eq_dec</a></span> <span class="id">l</span> <span class="id">j</span>). <span class="id">lia</span>. <span class="tactic">apply</span> <span class="id">fin</span>; <span class="id">lia</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="hupdate_same">hupdate_same</a></span>: <span class="kwd">forall</span> <span class="id">l</span> <span class="id">v</span> <span class="id">h</span>, (<span class="id"><a href="CDF.Separation.html#hupdate">hupdate</a></span> <span class="id">l</span> <span class="id">v</span> <span class="id">h</span>) <span class="id">l</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> <span class="id">v</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof116')">Proof.</div>
<div class="proofscript" id="proof116">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="id">cbn</span>. <span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.eq_dec">Z.eq_dec</a></span> <span class="id">l</span> <span class="id">l</span>); <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="hupdate_other">hupdate_other</a></span>: <span class="kwd">forall</span> <span class="id">l</span> <span class="id">v</span> <span class="id">h</span> <span class="id">l</span>', <span class="id">l</span> &lt;&gt; <span class="id">l</span>' -&gt; (<span class="id"><a href="CDF.Separation.html#hupdate">hupdate</a></span> <span class="id">l</span> <span class="id">v</span> <span class="id">h</span>) <span class="id">l</span>' = <span class="id">h</span> <span class="id">l</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof117')">Proof.</div>
<div class="proofscript" id="proof117">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="id">cbn</span>. <span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.eq_dec">Z.eq_dec</a></span> <span class="id">l</span> <span class="id">l</span>'); <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<div class="doc">The heap <span class="bracket"><span class="id">h</span></span> after deallocating address <span class="bracket"><span class="id">l</span></span>. </div>
<br/>
<span class="kwd">Program</span> <span class="kwd">Definition</span> <span class="id"><a name="hfree">hfree</a></span> (<span class="id">l</span>: <span class="id"><a href="CDF.Separation.html#addr">addr</a></span>) (<span class="id">h</span>: <span class="id"><a href="CDF.Separation.html#heap">heap</a></span>) : <span class="id"><a href="CDF.Separation.html#heap">heap</a></span> :=<br/>
&nbsp;&nbsp;{| <span class="id"><a href="CDF.Separation.html#contents">contents</a></span> := <span class="kwd">fun</span> <span class="id">l</span>' =&gt; <span class="kwd">if</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.eq_dec">Z.eq_dec</a></span> <span class="id">l</span> <span class="id">l</span>' <span class="kwd">then</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> <span class="kwd">else</span> <span class="id">h</span> <span class="id">l</span>' |}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof118')">Next Obligation.</div>
<div class="proofscript" id="proof118">
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CDF.Separation.html#isfinite">isfinite</a></span> <span class="id">h</span>) <span class="kwd">as</span> (<span class="id">i</span> &amp; <span class="id">fin</span>).<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">i</span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.eq_dec">Z.eq_dec</a></span> <span class="id">l</span> <span class="id">j</span>); <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">The heap <span class="bracket"><span class="id">h</span></span> where addresses <span class="bracket"><span class="id">l</span>, ..., <span class="id">l</span> + <span class="id">sz</span> - 1</span> are initialized to 0. </div>
<br/>
<span class="kwd">Fixpoint</span> <span class="id"><a name="hinit">hinit</a></span> (<span class="id">l</span>: <span class="id"><a href="CDF.Separation.html#addr">addr</a></span>) (<span class="id">sz</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#nat">nat</a></span>) (<span class="id">h</span>: <span class="id"><a href="CDF.Separation.html#heap">heap</a></span>) : <span class="id"><a href="CDF.Separation.html#heap">heap</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">sz</span> <span class="kwd">with</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#O">O</a></span> =&gt; <span class="id">h</span> | <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#S">S</a></span> <span class="id">sz</span> =&gt; <span class="id"><a href="CDF.Separation.html#hupdate">hupdate</a></span> <span class="id">l</span> 0 (<span class="id">hinit</span> (<span class="id">l</span> + 1) <span class="id">sz</span> <span class="id">h</span>) <span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="hinit_inside">hinit_inside</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">h</span> <span class="id">sz</span> <span class="id">l</span> <span class="id">l</span>', <span class="id">l</span> &lt;= <span class="id">l</span>' &lt; <span class="id">l</span> + <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.of_nat">Z.of_nat</a></span> <span class="id">sz</span> -&gt; <span class="id"><a href="CDF.Separation.html#hinit">hinit</a></span> <span class="id">l</span> <span class="id">sz</span> <span class="id">h</span> <span class="id">l</span>' = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#Some">Some</a></span> 0.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof119')">Proof.</div>
<div class="proofscript" id="proof119">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">sz</span>; <span class="tactic">intros</span>; <span class="id">cbn</span>.<br/>
- <span class="id">lia</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.eq_dec">Z.eq_dec</a></span> <span class="id">l</span> <span class="id">l</span>'); <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id">IHsz</span>. <span class="id">lia</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="hinit_outside">hinit_outside</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">h</span> <span class="id">sz</span> <span class="id">l</span> <span class="id">l</span>', <span class="id">l</span>' &lt; <span class="id">l</span> \/ <span class="id">l</span> + <span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.of_nat">Z.of_nat</a></span> <span class="id">sz</span> &lt;= <span class="id">l</span>' -&gt; <span class="id"><a href="CDF.Separation.html#hinit">hinit</a></span> <span class="id">l</span> <span class="id">sz</span> <span class="id">h</span> <span class="id">l</span>' = <span class="id">h</span> <span class="id">l</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof120')">Proof.</div>
<div class="proofscript" id="proof120">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">sz</span>; <span class="tactic">intros</span>; <span class="id">cbn</span>.<br/>
- <span class="tactic">auto</span>.<br/>
- <span class="tactic">destruct</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.eq_dec">Z.eq_dec</a></span> <span class="id">l</span> <span class="id">l</span>'). <span class="id">lia</span>. <span class="tactic">apply</span> <span class="id">IHsz</span>; <span class="id">lia</span>.<br/>
Qed.</div>
<br/>
<div class="doc">The disjoint union of two heaps. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="hdisjoint">hdisjoint</a></span> (<span class="id">h1</span> <span class="id">h2</span>: <span class="id"><a href="CDF.Separation.html#heap">heap</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">l</span>, <span class="id">h1</span> <span class="id">l</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span> \/ <span class="id">h2</span> <span class="id">l</span> = <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#None">None</a></span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="hdisjoint_sym">hdisjoint_sym</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">h1</span> <span class="id">h2</span>, <span class="id"><a href="CDF.Separation.html#hdisjoint">hdisjoint</a></span> <span class="id">h1</span> <span class="id">h2</span> &lt;-&gt; <span class="id"><a href="CDF.Separation.html#hdisjoint">hdisjoint</a></span> <span class="id">h2</span> <span class="id">h1</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof121')">Proof.</div>
<div class="proofscript" id="proof121">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CDF.Separation.html#hdisjoint">hdisjoint</a></span>; <span class="tactic">intros</span>; <span class="tactic">split</span>; <span class="tactic">intros</span> <span class="id">H</span> <span class="id">l</span>; <span class="id">specialize</span> (<span class="id">H</span> <span class="id">l</span>); <span class="tactic">tauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Program</span> <span class="kwd">Definition</span> <span class="id"><a name="hunion">hunion</a></span> (<span class="id">h1</span> <span class="id">h2</span>: <span class="id"><a href="CDF.Separation.html#heap">heap</a></span>) : <span class="id"><a href="CDF.Separation.html#heap">heap</a></span> :=<br/>
&nbsp;&nbsp;{| <span class="id"><a href="CDF.Separation.html#contents">contents</a></span> := <span class="kwd">fun</span> <span class="id">l</span> =&gt; <span class="kwd">if</span> <span class="id">h1</span> <span class="id">l</span> <span class="kwd">then</span> <span class="id">h1</span> <span class="id">l</span> <span class="kwd">else</span> <span class="id">h2</span> <span class="id">l</span> |}.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof122')">Next Obligation.</div>
<div class="proofscript" id="proof122">
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id"><a href="CDF.Separation.html#isfinite">isfinite</a></span> <span class="id">h1</span>) <span class="kwd">as</span> (<span class="id">i1</span> &amp; <span class="id">fin1</span>), (<span class="id"><a href="CDF.Separation.html#isfinite">isfinite</a></span> <span class="id">h2</span>) <span class="kwd">as</span> (<span class="id">i2</span> &amp; <span class="id">fin2</span>).<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="http://coq.inria.fr/library/Coq.ZArith.BinInt.html#Z.max">Z.max</a></span> <span class="id">i1</span> <span class="id">i2</span>); <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id">fin1</span>, <span class="id">fin2</span> <span class="tactic">by</span> <span class="id">lia</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="hunion_comm">hunion_comm</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">h1</span> <span class="id">h2</span>, <span class="id"><a href="CDF.Separation.html#hdisjoint">hdisjoint</a></span> <span class="id">h1</span> <span class="id">h2</span> -&gt; <span class="id"><a href="CDF.Separation.html#hunion">hunion</a></span> <span class="id">h2</span> <span class="id">h1</span> = <span class="id"><a href="CDF.Separation.html#hunion">hunion</a></span> <span class="id">h1</span> <span class="id">h2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof123')">Proof.</div>
<div class="proofscript" id="proof123">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">apply</span> <span class="id"><a href="CDF.Separation.html#heap_extensionality">heap_extensionality</a></span>; <span class="tactic">intros</span>; <span class="id">cbn</span>.<br/>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">H</span> <span class="id">l</span>). <span class="tactic">destruct</span> (<span class="id">h1</span> <span class="id">l</span>), (<span class="id">h2</span> <span class="id">l</span>); <span class="tactic">intuition</span> <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="hunion_assoc">hunion_assoc</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">h3</span>, <span class="id"><a href="CDF.Separation.html#hunion">hunion</a></span> (<span class="id"><a href="CDF.Separation.html#hunion">hunion</a></span> <span class="id">h1</span> <span class="id">h2</span>) <span class="id">h3</span> = <span class="id"><a href="CDF.Separation.html#hunion">hunion</a></span> <span class="id">h1</span> (<span class="id"><a href="CDF.Separation.html#hunion">hunion</a></span> <span class="id">h2</span> <span class="id">h3</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof124')">Proof.</div>
<div class="proofscript" id="proof124">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">apply</span> <span class="id"><a href="CDF.Separation.html#heap_extensionality">heap_extensionality</a></span>; <span class="tactic">intros</span>; <span class="id">cbn</span>. <span class="tactic">destruct</span> (<span class="id">h1</span> <span class="id">l</span>); <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="hunion_empty">hunion_empty</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">h</span>, <span class="id"><a href="CDF.Separation.html#hunion">hunion</a></span> <span class="id"><a href="CDF.Separation.html#hempty">hempty</a></span> <span class="id">h</span> = <span class="id">h</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof125')">Proof.</div>
<div class="proofscript" id="proof125">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">apply</span> <span class="id"><a href="CDF.Separation.html#heap_extensionality">heap_extensionality</a></span>; <span class="tactic">intros</span>; <span class="id">cbn</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="hdisjoint_union_l">hdisjoint_union_l</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">h3</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Separation.html#hdisjoint">hdisjoint</a></span> (<span class="id"><a href="CDF.Separation.html#hunion">hunion</a></span> <span class="id">h1</span> <span class="id">h2</span>) <span class="id">h3</span> &lt;-&gt; <span class="id"><a href="CDF.Separation.html#hdisjoint">hdisjoint</a></span> <span class="id">h1</span> <span class="id">h3</span> /\ <span class="id"><a href="CDF.Separation.html#hdisjoint">hdisjoint</a></span> <span class="id">h2</span> <span class="id">h3</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof126')">Proof.</div>
<div class="proofscript" id="proof126">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CDF.Separation.html#hdisjoint">hdisjoint</a></span>, <span class="id"><a href="CDF.Separation.html#hunion">hunion</a></span>; <span class="id">cbn</span>; <span class="tactic">intros</span>. <span class="tactic">split</span>.<br/>
- <span class="tactic">intros</span> <span class="id">D</span>; <span class="tactic">split</span>; <span class="tactic">intros</span> <span class="id">l</span>; <span class="tactic">destruct</span> (<span class="id">D</span> <span class="id">l</span>); <span class="tactic">auto</span>; <span class="tactic">destruct</span> (<span class="id">h1</span> <span class="id">l</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">discriminate</span>.<br/>
- <span class="tactic">intros</span> [<span class="id">D1</span> <span class="id">D2</span>] <span class="id">l</span>. <span class="tactic">destruct</span> (<span class="id">D2</span> <span class="id">l</span>); <span class="tactic">auto</span>. <span class="tactic">destruct</span> (<span class="id">h1</span> <span class="id">l</span>) <span class="id">eqn</span>:<span class="id">H1</span>; <span class="tactic">auto</span>. <span class="tactic">destruct</span> (<span class="id">D1</span> <span class="id">l</span>); <span class="tactic">auto</span>. <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="hdisjoint_union_r">hdisjoint_union_r</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">h3</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Separation.html#hdisjoint">hdisjoint</a></span> <span class="id">h1</span> (<span class="id"><a href="CDF.Separation.html#hunion">hunion</a></span> <span class="id">h2</span> <span class="id">h3</span>) &lt;-&gt; <span class="id"><a href="CDF.Separation.html#hdisjoint">hdisjoint</a></span> <span class="id">h1</span> <span class="id">h2</span> /\ <span class="id"><a href="CDF.Separation.html#hdisjoint">hdisjoint</a></span> <span class="id">h1</span> <span class="id">h3</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof127')">Proof.</div>
<div class="proofscript" id="proof127">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id"><a href="CDF.Separation.html#hdisjoint_sym">hdisjoint_sym</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="CDF.Separation.html#hdisjoint_union_l">hdisjoint_union_l</a></span>. <br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="CDF.Separation.html#hdisjoint_sym">hdisjoint_sym</a></span> <span class="id">h2</span>), (<span class="id"><a href="CDF.Separation.html#hdisjoint_sym">hdisjoint_sym</a></span> <span class="id">h3</span>). <span class="tactic">tauto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Disjointness between three heaps. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="hdisj3">hdisj3</a></span> (<span class="id">h1</span> <span class="id">h2</span> <span class="id">h3</span>: <span class="id"><a href="CDF.Separation.html#heap">heap</a></span>) :=<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Separation.html#hdisjoint">hdisjoint</a></span> <span class="id">h1</span> <span class="id">h2</span> /\ <span class="id"><a href="CDF.Separation.html#hdisjoint">hdisjoint</a></span> <span class="id">h1</span> <span class="id">h3</span> /\ <span class="id"><a href="CDF.Separation.html#hdisjoint">hdisjoint</a></span> <span class="id">h2</span> <span class="id">h3</span>.<br/>
<br/>
<div class="doc">A tactic to prove disjointness statements. </div>
<br/>
<span class="kwd">Ltac</span> <span class="id">HDISJ</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [ <span class="id">H</span>: <span class="id"><a href="CDF.Separation.html#hdisj3">hdisj3</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> |- <span class="id">_</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> (? &amp; ? &amp; ?); <span class="id">HDISJ</span><br/>
&nbsp;&nbsp;| [ <span class="id">H</span>: <span class="id"><a href="CDF.Separation.html#hdisjoint">hdisjoint</a></span> (<span class="id"><a href="CDF.Separation.html#hunion">hunion</a></span> <span class="id">_</span> <span class="id">_</span>) <span class="id">_</span> |- <span class="id">_</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Separation.html#hdisjoint_union_l">hdisjoint_union_l</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">destruct</span> <span class="id">H</span>; <span class="id">HDISJ</span><br/>
&nbsp;&nbsp;| [ <span class="id">H</span>: <span class="id"><a href="CDF.Separation.html#hdisjoint">hdisjoint</a></span> <span class="id">_</span> (<span class="id"><a href="CDF.Separation.html#hunion">hunion</a></span> <span class="id">_</span> <span class="id">_</span>) |- <span class="id">_</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Separation.html#hdisjoint_union_r">hdisjoint_union_r</a></span> <span class="kwd">in</span> <span class="id">H</span>; <span class="tactic">destruct</span> <span class="id">H</span>; <span class="id">HDISJ</span><br/>
&nbsp;&nbsp;| [ |- <span class="id"><a href="CDF.Separation.html#hdisj3">hdisj3</a></span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">split</span>; [|<span class="tactic">split</span>]; <span class="id">HDISJ</span><br/>
&nbsp;&nbsp;| [ |- <span class="id"><a href="CDF.Separation.html#hdisjoint">hdisjoint</a></span> (<span class="id"><a href="CDF.Separation.html#hunion">hunion</a></span> <span class="id">_</span> <span class="id">_</span>) <span class="id">_</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Separation.html#hdisjoint_union_l">hdisjoint_union_l</a></span>; <span class="tactic">split</span>; <span class="id">HDISJ</span><br/>
&nbsp;&nbsp;| [ |- <span class="id"><a href="CDF.Separation.html#hdisjoint">hdisjoint</a></span> <span class="id">_</span> (<span class="id"><a href="CDF.Separation.html#hunion">hunion</a></span> <span class="id">_</span> <span class="id">_</span>) ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Separation.html#hdisjoint_union_r">hdisjoint_union_r</a></span>; <span class="tactic">split</span>; <span class="id">HDISJ</span><br/>
&nbsp;&nbsp;| [ |- <span class="id"><a href="CDF.Separation.html#hdisjoint">hdisjoint</a></span> <span class="id"><a href="CDF.Separation.html#hempty">hempty</a></span> <span class="id">_</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">auto</span><br/>
&nbsp;&nbsp;| [ |- <span class="id"><a href="CDF.Separation.html#hdisjoint">hdisjoint</a></span> <span class="id">_</span> <span class="id"><a href="CDF.Separation.html#hempty">hempty</a></span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">auto</span><br/>
&nbsp;&nbsp;| [ |- <span class="id"><a href="CDF.Separation.html#hdisjoint">hdisjoint</a></span> <span class="id">_</span> <span class="id">_</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span> || (<span class="tactic">apply</span> <span class="id"><a href="CDF.Separation.html#hdisjoint_sym">hdisjoint_sym</a></span>; <span class="tactic">assumption</span>) || <span class="id">idtac</span><br/>
&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="id">idtac</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="hunion_invert_r">hunion_invert_r</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">h</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Separation.html#hunion">hunion</a></span> <span class="id">h</span> <span class="id">h1</span> = <span class="id"><a href="CDF.Separation.html#hunion">hunion</a></span> <span class="id">h</span> <span class="id">h2</span> -&gt; <span class="id"><a href="CDF.Separation.html#hdisjoint">hdisjoint</a></span> <span class="id">h</span> <span class="id">h1</span> -&gt; <span class="id"><a href="CDF.Separation.html#hdisjoint">hdisjoint</a></span> <span class="id">h</span> <span class="id">h2</span> -&gt; <span class="id">h1</span> = <span class="id">h2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof128')">Proof.</div>
<div class="proofscript" id="proof128">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Separation.html#heap_extensionality">heap_extensionality</a></span>; <span class="tactic">intros</span> <span class="id">l</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="CDF.Separation.html#hunion">hunion</a></span> <span class="id">h</span> <span class="id">h1</span> <span class="id">l</span> = <span class="id"><a href="CDF.Separation.html#hunion">hunion</a></span> <span class="id">h</span> <span class="id">h2</span> <span class="id">l</span>) <span class="tactic">by</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="id">cbn</span> <span class="kwd">in</span> <span class="id">H2</span>. <span class="id">specialize</span> (<span class="id">H0</span> <span class="id">l</span>); <span class="id">specialize</span> (<span class="id">H1</span> <span class="id">l</span>). <span class="tactic">destruct</span> (<span class="id">h</span> <span class="id">l</span>); <span class="tactic">intuition</span> <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="hunion_invert_l">hunion_invert_l</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">h</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Separation.html#hunion">hunion</a></span> <span class="id">h1</span> <span class="id">h</span> = <span class="id"><a href="CDF.Separation.html#hunion">hunion</a></span> <span class="id">h2</span> <span class="id">h</span> -&gt; <span class="id"><a href="CDF.Separation.html#hdisjoint">hdisjoint</a></span> <span class="id">h1</span> <span class="id">h</span> -&gt; <span class="id"><a href="CDF.Separation.html#hdisjoint">hdisjoint</a></span> <span class="id">h2</span> <span class="id">h</span> -&gt; <span class="id">h1</span> = <span class="id">h2</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof129')">Proof.</div>
<div class="proofscript" id="proof129">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Separation.html#hunion_invert_r">hunion_invert_r</a></span> <span class="kwd">with</span> <span class="id">h</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- ! (<span class="id"><a href="CDF.Separation.html#hunion_comm">hunion_comm</a></span> <span class="id">h</span>) <span class="tactic">by</span> <span class="id">HDISJ</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">HDISJ</span>. <span class="id">HDISJ</span>.<br/>
Qed.</div>
<br/>
<h1> 2. Assertions for separation logic </h1>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="assertion">assertion</a></span> : <span class="kwd">Type</span> := <span class="id"><a href="CDF.Separation.html#heap">heap</a></span> -&gt; <span class="kwd">Prop</span>.<br/>
<br/>
<div class="doc">Implication (entailment). </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="aimp">aimp</a></span> (<span class="id">P</span> <span class="id">Q</span>: <span class="id"><a href="CDF.Separation.html#assertion">assertion</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">h</span>, <span class="id">P</span> <span class="id">h</span> -&gt; <span class="id">Q</span> <span class="id">h</span>.<br/>
<br/>
<span class="kwd">Notation</span> "<span class="id">P</span> --&gt;&gt; <span class="id">Q</span>" := (<span class="id"><a href="CDF.Separation.html#aimp">aimp</a></span> <span class="id">P</span> <span class="id">Q</span>) (<span class="tactic">at</span> <span class="id">level</span> 95, <span class="id">no</span> <span class="id">associativity</span>).<br/>
<br/>
<div class="doc">Quantification. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="aexists">aexists</a></span> {<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">P</span>: <span class="id">A</span> -&gt; <span class="id"><a href="CDF.Separation.html#assertion">assertion</a></span>) : <span class="id"><a href="CDF.Separation.html#assertion">assertion</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">h</span> =&gt; <span class="id">exists</span> <span class="id">a</span>: <span class="id">A</span>, <span class="id">P</span> <span class="id">a</span> <span class="id">h</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="aforall">aforall</a></span> {<span class="id">A</span>: <span class="kwd">Type</span>} (<span class="id">P</span>: <span class="id">A</span> -&gt; <span class="id"><a href="CDF.Separation.html#assertion">assertion</a></span>) : <span class="id"><a href="CDF.Separation.html#assertion">assertion</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">h</span> =&gt; <span class="kwd">forall</span> <span class="id">a</span>: <span class="id">A</span>, <span class="id">P</span> <span class="id">a</span> <span class="id">h</span>.<br/>
<br/>
<div class="doc">The assertion "the heap is empty". </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="emp">emp</a></span> : <span class="id"><a href="CDF.Separation.html#assertion">assertion</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">h</span> =&gt; <span class="id">h</span> = <span class="id"><a href="CDF.Separation.html#hempty">hempty</a></span>.<br/>
<br/>
<div class="doc">The pure assertion: "the heap is empty and P holds". </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="pure">pure</a></span> (<span class="id">P</span>: <span class="kwd">Prop</span>) : <span class="id"><a href="CDF.Separation.html#assertion">assertion</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">h</span> =&gt; <span class="id">P</span> /\ <span class="id">h</span> = <span class="id"><a href="CDF.Separation.html#hempty">hempty</a></span>.<br/>
<br/>
<div class="doc">The assertion "address <span class="bracket"><span class="id">l</span></span> contains value <span class="bracket"><span class="id">v</span></span>". 
    The domain of the heap must be the singleton <span class="bracket">{<span class="id">l</span>}</span>. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="contains">contains</a></span> (<span class="id">l</span>: <span class="id"><a href="CDF.Separation.html#addr">addr</a></span>) (<span class="id">v</span>: <span class="id"><a href="http://coq.inria.fr/library/Coq.Numbers.BinNums.html#Z">Z</a></span>) : <span class="id"><a href="CDF.Separation.html#assertion">assertion</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">h</span> =&gt; <span class="id">h</span> = <span class="id"><a href="CDF.Separation.html#hupdate">hupdate</a></span> <span class="id">l</span> <span class="id">v</span> <span class="id"><a href="CDF.Separation.html#hempty">hempty</a></span>.<br/>
<br/>
<div class="doc">The assertion "address <span class="bracket"><span class="id">l</span></span> is valid" (i.e. in the domain of the heap). </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="valid">valid</a></span> (<span class="id">l</span>: <span class="id"><a href="CDF.Separation.html#addr">addr</a></span>) : <span class="id"><a href="CDF.Separation.html#assertion">assertion</a></span> := <span class="id"><a href="CDF.Separation.html#aexists">aexists</a></span> (<span class="id"><a href="CDF.Separation.html#contains">contains</a></span> <span class="id">l</span>).<br/>
<br/>
<div class="doc">The separating conjunction. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="sepconj">sepconj</a></span> (<span class="id">P</span> <span class="id">Q</span>: <span class="id"><a href="CDF.Separation.html#assertion">assertion</a></span>) : <span class="id"><a href="CDF.Separation.html#assertion">assertion</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">h</span> =&gt; <span class="id">exists</span> <span class="id">h1</span> <span class="id">h2</span>, <span class="id">P</span> <span class="id">h1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id">Q</span> <span class="id">h2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id"><a href="CDF.Separation.html#hdisjoint">hdisjoint</a></span> <span class="id">h1</span> <span class="id">h2</span>  /\ <span class="id">h</span> = <span class="id"><a href="CDF.Separation.html#hunion">hunion</a></span> <span class="id">h1</span> <span class="id">h2</span>.<br/>
<br/>
<span class="kwd">Notation</span> "<span class="id">P</span> ** <span class="id">Q</span>" := (<span class="id"><a href="CDF.Separation.html#sepconj">sepconj</a></span> <span class="id">P</span> <span class="id">Q</span>) (<span class="tactic">at</span> <span class="id">level</span> 60, <span class="id">right</span> <span class="id">associativity</span>).<br/>
<br/>
<div class="doc">The conjunction of a simple assertion and a general assertion. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="pureconj">pureconj</a></span> (<span class="id">P</span>: <span class="kwd">Prop</span>) (<span class="id">Q</span>: <span class="id"><a href="CDF.Separation.html#assertion">assertion</a></span>) : <span class="id"><a href="CDF.Separation.html#assertion">assertion</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">h</span> =&gt; <span class="id">P</span> /\ <span class="id">Q</span> <span class="id">h</span>.<br/>
<br/>
<span class="kwd">Notation</span> "<span class="id">P</span> //\\ <span class="id">Q</span>" := (<span class="id"><a href="CDF.Separation.html#pureconj">pureconj</a></span> <span class="id">P</span> <span class="id">Q</span>) (<span class="tactic">at</span> <span class="id">level</span> 60, <span class="id">right</span> <span class="id">associativity</span>).<br/>
<br/>
<div class="doc">Plain conjunction and disjunction. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="aand">aand</a></span> (<span class="id">P</span> <span class="id">Q</span>: <span class="id"><a href="CDF.Separation.html#assertion">assertion</a></span>) : <span class="id"><a href="CDF.Separation.html#assertion">assertion</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">h</span> =&gt; <span class="id">P</span> <span class="id">h</span> /\ <span class="id">Q</span> <span class="id">h</span>.<br/>
<span class="kwd">Definition</span> <span class="id"><a name="aor">aor</a></span> (<span class="id">P</span> <span class="id">Q</span>: <span class="id"><a href="CDF.Separation.html#assertion">assertion</a></span>) : <span class="id"><a href="CDF.Separation.html#assertion">assertion</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">h</span> =&gt; <span class="id">P</span> <span class="id">h</span> \/ <span class="id">Q</span> <span class="id">h</span>.<br/>
<br/>
<div class="doc">Extensional equality between assertions. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="assertion_extensionality">assertion_extensionality</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">P</span> <span class="id">Q</span>: <span class="id"><a href="CDF.Separation.html#assertion">assertion</a></span>),<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">h</span>, <span class="id">P</span> <span class="id">h</span> &lt;-&gt; <span class="id">Q</span> <span class="id">h</span>) -&gt; <span class="id">P</span> = <span class="id">Q</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof130')">Proof.</div>
<div class="proofscript" id="proof130">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.FunctionalExtensionality.html#functional_extensionality">functional_extensionality</a></span>; <span class="tactic">intros</span> <span class="id">h</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Logic.PropExtensionality.html#propositional_extensionality">propositional_extensionality</a></span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<h2> Properties of separating conjunction </h2>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="sepconj_comm">sepconj_comm</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">Q</span>, <span class="id">P</span> ** <span class="id">Q</span> = <span class="id">Q</span> ** <span class="id">P</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof131')">Proof.</div>
<div class="proofscript" id="proof131">
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="kwd">forall</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">h</span>, (<span class="id">P</span> ** <span class="id">Q</span>) <span class="id">h</span> -&gt; (<span class="id">Q</span> ** <span class="id">P</span>) <span class="id">h</span>).<br/>
&nbsp;&nbsp;{ <span class="tactic">intros</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">h</span> (<span class="id">h1</span> &amp; <span class="id">h2</span> &amp; <span class="id">P1</span> &amp; <span class="id">Q2</span> &amp; <span class="id">EQ</span> &amp; <span class="id">DISJ</span>); <span class="tactic">subst</span> <span class="id">h</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">h2</span>, <span class="id">h1</span>; <span class="tactic">intuition</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Separation.html#hdisjoint_sym">hdisjoint_sym</a></span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">symmetry</span>; <span class="tactic">apply</span> <span class="id"><a href="CDF.Separation.html#hunion_comm">hunion_comm</a></span>; <span class="tactic">auto</span>. } <br/>
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">apply</span> <span class="id"><a href="CDF.Separation.html#assertion_extensionality">assertion_extensionality</a></span>; <span class="tactic">intros</span>; <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="sepconj_assoc">sepconj_assoc</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">R</span>, (<span class="id">P</span> ** <span class="id">Q</span>) ** <span class="id">R</span> = <span class="id">P</span> ** (<span class="id">Q</span> ** <span class="id">R</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof132')">Proof.</div>
<div class="proofscript" id="proof132">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">apply</span> <span class="id"><a href="CDF.Separation.html#assertion_extensionality">assertion_extensionality</a></span>; <span class="tactic">intros</span>; <span class="tactic">split</span>.<br/>
- <span class="tactic">intros</span> (<span class="id">hx</span> &amp; <span class="id">h3</span> &amp; (<span class="id">h1</span> &amp; <span class="id">h2</span> &amp; <span class="id">P1</span> &amp; <span class="id">Q2</span> &amp; <span class="id">EQ</span> &amp; <span class="id">DISJ</span>) &amp; <span class="id">R3</span> &amp; <span class="id">EQ</span>' &amp; <span class="id">DISJ</span>'). <span class="tactic">subst</span> <span class="id">hx</span> <span class="id">h</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CDF.Separation.html#hdisjoint_union_l">hdisjoint_union_l</a></span> <span class="kwd">in</span> <span class="id">EQ</span>'. <span class="tactic">rewrite</span> <span class="id"><a href="CDF.Separation.html#hunion_assoc">hunion_assoc</a></span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">h1</span>, (<span class="id"><a href="CDF.Separation.html#hunion">hunion</a></span> <span class="id">h2</span> <span class="id">h3</span>); <span class="tactic">intuition</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">h2</span>, <span class="id">h3</span>; <span class="tactic">intuition</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CDF.Separation.html#hdisjoint_union_r">hdisjoint_union_r</a></span>; <span class="tactic">tauto</span>.<br/>
- <span class="tactic">intros</span> (<span class="id">h1</span> &amp; <span class="id">hx</span> &amp; <span class="id">P1</span> &amp; (<span class="id">h2</span> &amp; <span class="id">h3</span> &amp; <span class="id">Q2</span> &amp; <span class="id">R3</span> &amp; <span class="id">EQ</span> &amp; <span class="id">DISJ</span>) &amp; <span class="id">EQ</span>' &amp; <span class="id">DISJ</span>'). <span class="tactic">subst</span> <span class="id">hx</span> <span class="id">h</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CDF.Separation.html#hdisjoint_union_r">hdisjoint_union_r</a></span> <span class="kwd">in</span> <span class="id">EQ</span>'. <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="CDF.Separation.html#hunion_assoc">hunion_assoc</a></span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="CDF.Separation.html#hunion">hunion</a></span> <span class="id">h1</span> <span class="id">h2</span>), <span class="id">h3</span>; <span class="tactic">intuition</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">h1</span>, <span class="id">h2</span>; <span class="tactic">intuition</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CDF.Separation.html#hdisjoint_union_l">hdisjoint_union_l</a></span>; <span class="tactic">tauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="sepconj_emp">sepconj_emp</a></span>: <span class="kwd">forall</span> <span class="id">P</span>, <span class="id"><a href="CDF.Separation.html#emp">emp</a></span> ** <span class="id">P</span> = <span class="id">P</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof133')">Proof.</div>
<div class="proofscript" id="proof133">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">apply</span> <span class="id"><a href="CDF.Separation.html#assertion_extensionality">assertion_extensionality</a></span>; <span class="tactic">intros</span>; <span class="tactic">split</span>.<br/>
- <span class="tactic">intros</span> (<span class="id">h1</span> &amp; <span class="id">h2</span> &amp; <span class="id">EMP1</span> &amp; <span class="id">P2</span> &amp; <span class="id">EQ</span> &amp; <span class="id">DISJ</span>). <span class="tactic">red</span> <span class="kwd">in</span> <span class="id">EMP1</span>. <span class="tactic">subst</span> <span class="id">h</span> <span class="id">h1</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CDF.Separation.html#hunion_empty">hunion_empty</a></span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">intros</span>. <span class="id">exists</span> <span class="id"><a href="CDF.Separation.html#hempty">hempty</a></span>, <span class="id">h</span>; <span class="tactic">intuition</span> <span class="tactic">auto</span>. <br/>
&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CDF.Separation.html#hunion_empty">hunion_empty</a></span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="sepconj_imp_l">sepconj_imp_l</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">R</span>,<br/>
&nbsp;&nbsp;(<span class="id">P</span> --&gt;&gt; <span class="id">Q</span>) -&gt; (<span class="id">P</span> ** <span class="id">R</span> --&gt;&gt; <span class="id">Q</span> ** <span class="id">R</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof134')">Proof.</div>
<div class="proofscript" id="proof134">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">R</span> <span class="id">IMP</span> <span class="id">h</span> (<span class="id">h1</span> &amp; <span class="id">h2</span> &amp; <span class="id">P1</span> &amp; <span class="id">Q2</span> &amp; <span class="id">D</span> &amp; <span class="id">U</span>).<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">h1</span>, <span class="id">h2</span>; <span class="tactic">intuition</span> <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="sepconj_imp_r">sepconj_imp_r</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">R</span>,<br/>
&nbsp;&nbsp;(<span class="id">P</span> --&gt;&gt; <span class="id">Q</span>) -&gt; (<span class="id">R</span> ** <span class="id">P</span> --&gt;&gt; <span class="id">R</span> ** <span class="id">Q</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof135')">Proof.</div>
<div class="proofscript" id="proof135">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rewrite</span> ! (<span class="id"><a href="CDF.Separation.html#sepconj_comm">sepconj_comm</a></span> <span class="id">R</span>). <span class="tactic">apply</span> <span class="id"><a href="CDF.Separation.html#sepconj_imp_l">sepconj_imp_l</a></span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<h2> Other useful logical properties </h2>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="pure_sep">pure_sep</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">Q</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Separation.html#pure">pure</a></span> (<span class="id">P</span> /\ <span class="id">Q</span>) = <span class="id"><a href="CDF.Separation.html#pure">pure</a></span> <span class="id">P</span> ** <span class="id"><a href="CDF.Separation.html#pure">pure</a></span> <span class="id">Q</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof136')">Proof.</div>
<div class="proofscript" id="proof136">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Separation.html#assertion_extensionality">assertion_extensionality</a></span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CDF.Separation.html#pure">pure</a></span>, <span class="id"><a href="CDF.Separation.html#sepconj">sepconj</a></span>. <span class="tactic">split</span>.<br/>
- <span class="tactic">intros</span> ((<span class="id">A</span> &amp; <span class="id">B</span>) &amp; <span class="id">C</span>). <span class="tactic">subst</span> <span class="id">h</span>. <span class="id">exists</span> <span class="id"><a href="CDF.Separation.html#hempty">hempty</a></span>, <span class="id"><a href="CDF.Separation.html#hempty">hempty</a></span>; <span class="tactic">intuition</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intro</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CDF.Separation.html#hunion_empty">hunion_empty</a></span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">intros</span> (<span class="id">h1</span> &amp; <span class="id">h2</span> &amp; (<span class="id">PP</span> &amp; <span class="id">E1</span>) &amp; (<span class="id">QQ</span> &amp; <span class="id">E2</span>) &amp; <span class="id">C</span> &amp; <span class="id">D</span>).<br/>
&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">rewrite</span> <span class="id"><a href="CDF.Separation.html#hunion_empty">hunion_empty</a></span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="pureconj_sepconj">pureconj_sepconj</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">Q</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Separation.html#pure">pure</a></span> <span class="id">P</span> ** <span class="id">Q</span> = <span class="id">P</span> //\\ <span class="id">Q</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof137')">Proof.</div>
<div class="proofscript" id="proof137">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Separation.html#assertion_extensionality">assertion_extensionality</a></span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CDF.Separation.html#pure">pure</a></span>, <span class="id"><a href="CDF.Separation.html#sepconj">sepconj</a></span>, <span class="id"><a href="CDF.Separation.html#pureconj">pureconj</a></span>; <span class="tactic">split</span>.<br/>
- <span class="tactic">intros</span> (<span class="id">h1</span> &amp; <span class="id">h2</span> &amp; (<span class="id">A</span> &amp; <span class="id">B</span>) &amp; <span class="id">C</span> &amp; <span class="id">D</span> &amp; <span class="id">E</span>).<br/>
&nbsp;&nbsp;<span class="tactic">split</span>. <span class="tactic">auto</span>. <span class="tactic">subst</span>. <span class="tactic">rewrite</span> <span class="id"><a href="CDF.Separation.html#hunion_empty">hunion_empty</a></span>. <span class="tactic">auto</span>.<br/>
- <span class="tactic">intros</span> (<span class="id">A</span> &amp; <span class="id">B</span>). <span class="id">exists</span> <span class="id"><a href="CDF.Separation.html#hempty">hempty</a></span>, <span class="id">h</span>; <span class="tactic">intuition</span> <span class="tactic">auto</span>.  <br/>
&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">l</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CDF.Separation.html#hunion_empty">hunion_empty</a></span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="lift_pureconj">lift_pureconj</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">R</span>, (<span class="id">P</span> //\\ <span class="id">Q</span>) ** <span class="id">R</span> = <span class="id">P</span> //\\ (<span class="id">Q</span> ** <span class="id">R</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof138')">Proof.</div>
<div class="proofscript" id="proof138">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rewrite</span> &lt;- ! <span class="id"><a href="CDF.Separation.html#pureconj_sepconj">pureconj_sepconj</a></span>. <span class="tactic">rewrite</span> <span class="id"><a href="CDF.Separation.html#sepconj_assoc">sepconj_assoc</a></span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="lift_aexists">lift_aexists</a></span>: <span class="kwd">forall</span> (<span class="id">A</span>: <span class="kwd">Type</span>) (<span class="id">P</span>: <span class="id">A</span> -&gt; <span class="id"><a href="CDF.Separation.html#assertion">assertion</a></span>) <span class="id">Q</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Separation.html#aexists">aexists</a></span> <span class="id">P</span> ** <span class="id">Q</span> = <span class="id"><a href="CDF.Separation.html#aexists">aexists</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">P</span> <span class="id">x</span> ** <span class="id">Q</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof139')">Proof.</div>
<div class="proofscript" id="proof139">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">apply</span> <span class="id"><a href="CDF.Separation.html#assertion_extensionality">assertion_extensionality</a></span>; <span class="tactic">intros</span>; <span class="tactic">split</span>.<br/>
- <span class="tactic">intros</span> (<span class="id">h1</span> &amp; <span class="id">h2</span> &amp; (<span class="id">a</span> &amp; <span class="id">P1</span>) &amp; <span class="id">Q2</span> &amp; <span class="id">DISJ</span> &amp; <span class="id">EQ</span>).<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">a</span>, <span class="id">h1</span>, <span class="id">h2</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">intros</span> (<span class="id">a</span> &amp; <span class="id">h1</span> &amp; <span class="id">h2</span> &amp; <span class="id">P1</span> &amp; <span class="id">Q2</span> &amp; <span class="id">DISJ</span> &amp; <span class="id">EQ</span>).<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">h1</span>, <span class="id">h2</span>; <span class="tactic">intuition</span> <span class="tactic">auto</span>. <span class="id">exists</span> <span class="id">a</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="sepconj_swap3">sepconj_swap3</a></span>: <span class="kwd">forall</span> <span class="id">R</span> <span class="id">P</span> <span class="id">Q</span>, <span class="id">P</span> ** <span class="id">Q</span> ** <span class="id">R</span> = <span class="id">R</span> ** <span class="id">P</span> ** <span class="id">Q</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof140')">Proof.</div>
<div class="proofscript" id="proof140">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="CDF.Separation.html#sepconj_assoc">sepconj_assoc</a></span>, <span class="id"><a href="CDF.Separation.html#sepconj_comm">sepconj_comm</a></span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="sepconj_swap4">sepconj_swap4</a></span>: <span class="kwd">forall</span> <span class="id">S</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">R</span>, <span class="id">P</span> ** <span class="id">Q</span> ** <span class="id">R</span> ** <span class="id">S</span> = <span class="id">S</span> ** <span class="id">P</span> ** <span class="id">Q</span> ** <span class="id">R</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof141')">Proof.</div>
<div class="proofscript" id="proof141">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="CDF.Separation.html#sepconj_assoc">sepconj_assoc</a></span>, <span class="id"><a href="CDF.Separation.html#sepconj_swap3">sepconj_swap3</a></span>, <span class="id"><a href="CDF.Separation.html#sepconj_assoc">sepconj_assoc</a></span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="sepconj_pick2">sepconj_pick2</a></span>: <span class="kwd">forall</span> <span class="id">Q</span> <span class="id">P</span> <span class="id">R</span>, <span class="id">P</span> ** <span class="id">Q</span> ** <span class="id">R</span> = <span class="id">Q</span> ** <span class="id">P</span> ** <span class="id">R</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof142')">Proof.</div>
<div class="proofscript" id="proof142">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rewrite</span> (<span class="id"><a href="CDF.Separation.html#sepconj_comm">sepconj_comm</a></span> <span class="id">Q</span>), &lt;- <span class="id"><a href="CDF.Separation.html#sepconj_assoc">sepconj_assoc</a></span>, <span class="id"><a href="CDF.Separation.html#sepconj_comm">sepconj_comm</a></span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="sepconj_pick3">sepconj_pick3</a></span>: <span class="kwd">forall</span> <span class="id">R</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">S</span>, <span class="id">P</span> ** <span class="id">Q</span> ** <span class="id">R</span> ** <span class="id">S</span> = <span class="id">R</span> ** <span class="id">P</span> ** <span class="id">Q</span> ** <span class="id">S</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof143')">Proof.</div>
<div class="proofscript" id="proof143">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">rewrite</span> (<span class="id"><a href="CDF.Separation.html#sepconj_pick2">sepconj_pick2</a></span> <span class="id">R</span>), (<span class="id"><a href="CDF.Separation.html#sepconj_pick2">sepconj_pick2</a></span> <span class="id">P</span>). <span class="tactic">auto</span>. <br/>
Qed.</div>
<br/>
<h2> Magic wand </h2>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="wand">wand</a></span> (<span class="id">P</span> <span class="id">Q</span>: <span class="id"><a href="CDF.Separation.html#assertion">assertion</a></span>) : <span class="id"><a href="CDF.Separation.html#assertion">assertion</a></span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">h</span> =&gt; <span class="kwd">forall</span> <span class="id">h</span>', <span class="id"><a href="CDF.Separation.html#hdisjoint">hdisjoint</a></span> <span class="id">h</span> <span class="id">h</span>' -&gt; <span class="id">P</span> <span class="id">h</span>' -&gt; <span class="id">Q</span> (<span class="id"><a href="CDF.Separation.html#hunion">hunion</a></span> <span class="id">h</span> <span class="id">h</span>').<br/>
<br/>
<span class="kwd">Notation</span> "<span class="id">P</span> --* <span class="id">Q</span>" := (<span class="id"><a href="CDF.Separation.html#wand">wand</a></span> <span class="id">P</span> <span class="id">Q</span>) (<span class="tactic">at</span> <span class="id">level</span> 70, <span class="id">right</span> <span class="id">associativity</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="wand_intro">wand_intro</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">R</span>,<br/>
&nbsp;&nbsp;<span class="id">P</span> ** <span class="id">Q</span> --&gt;&gt; <span class="id">R</span>  -&gt;  <span class="id">P</span> --&gt;&gt; <span class="id">Q</span> --* <span class="id">R</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof144')">Proof.</div>
<div class="proofscript" id="proof144">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">R</span> <span class="id">IMP</span> <span class="id">h</span> <span class="id">Ph</span> <span class="id">h</span>' <span class="id">DISJ</span> <span class="id">Qh</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">IMP</span>. <span class="id">exists</span> <span class="id">h</span>, <span class="id">h</span>'; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="wand_cancel">wand_cancel</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">Q</span>,<br/>
&nbsp;&nbsp;<span class="id">P</span> ** (<span class="id">P</span> --* <span class="id">Q</span>) --&gt;&gt; <span class="id">Q</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof145')">Proof.</div>
<div class="proofscript" id="proof145">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">h</span> (<span class="id">h1</span> &amp; <span class="id">h2</span> &amp; <span class="id">Ph1</span> &amp; <span class="id">Wh2</span> &amp; <span class="id">D</span> &amp; <span class="id">U</span>). <span class="tactic">subst</span> <span class="id">h</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">D</span>': <span class="id"><a href="CDF.Separation.html#hdisjoint">hdisjoint</a></span> <span class="id">h2</span> <span class="id">h1</span>) <span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id"><a href="CDF.Separation.html#hdisjoint_sym">hdisjoint_sym</a></span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CDF.Separation.html#hunion_comm">hunion_comm</a></span> <span class="tactic">by</span> <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id">Wh2</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="wand_charact">wand_charact</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">Q</span>,<br/>
&nbsp;&nbsp;(<span class="id">P</span> --*<span class="id">Q</span>) = (<span class="id"><a href="CDF.Separation.html#aexists">aexists</a></span> (<span class="kwd">fun</span> <span class="id">R</span> =&gt; (<span class="id">P</span> ** <span class="id">R</span> --&gt;&gt; <span class="id">Q</span>) //\\ <span class="id">R</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof146')">Proof.</div>
<div class="proofscript" id="proof146">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">P</span> <span class="id">Q</span>; <span class="tactic">apply</span> <span class="id"><a href="CDF.Separation.html#assertion_extensionality">assertion_extensionality</a></span>; <span class="tactic">intros</span> <span class="id">h</span>; <span class="tactic">split</span>.<br/>
- <span class="tactic">intros</span> <span class="id">W</span>. <span class="id">exists</span> (<span class="id">P</span> --* <span class="id">Q</span>). <span class="tactic">split</span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Separation.html#wand_cancel">wand_cancel</a></span>.<br/>
- <span class="tactic">intros</span> (<span class="id">R</span> &amp; <span class="id">A</span> &amp; <span class="id">B</span>) <span class="id">h</span>' <span class="id">D</span> <span class="id">Ph</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">D</span>': <span class="id"><a href="CDF.Separation.html#hdisjoint">hdisjoint</a></span> <span class="id">h</span>' <span class="id">h</span>) <span class="tactic">by</span> (<span class="tactic">apply</span> <span class="id"><a href="CDF.Separation.html#hdisjoint_sym">hdisjoint_sym</a></span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id"><a href="CDF.Separation.html#hunion_comm">hunion_comm</a></span> <span class="tactic">by</span> <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id">A</span>. <span class="id">exists</span> <span class="id">h</span>', <span class="id">h</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="wand_equiv">wand_equiv</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">R</span>,<br/>
&nbsp;&nbsp;(<span class="id">P</span> --&gt;&gt; (<span class="id">Q</span> --* <span class="id">R</span>)) &lt;-&gt; (<span class="id">P</span> ** <span class="id">Q</span> --&gt;&gt; <span class="id">R</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof147')">Proof.</div>
<div class="proofscript" id="proof147">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">split</span>; <span class="tactic">intros</span> <span class="id">H</span>.<br/>
- <span class="tactic">intros</span> <span class="id">h</span> (<span class="id">h1</span> &amp; <span class="id">h2</span> &amp; <span class="id">Ph1</span> &amp; <span class="id">Wh2</span> &amp; <span class="id">D</span> &amp; <span class="id">U</span>). <span class="tactic">subst</span> <span class="id">h</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">H</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">apply</span> <span class="id"><a href="CDF.Separation.html#wand_intro">wand_intro</a></span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="wand_imp_l">wand_imp_l</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">P</span>' <span class="id">Q</span>,<br/>
&nbsp;&nbsp;(<span class="id">P</span>' --&gt;&gt; <span class="id">P</span>) -&gt; (<span class="id">P</span> --* <span class="id">Q</span> --&gt;&gt; <span class="id">P</span>' --* <span class="id">Q</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof148')">Proof.</div>
<div class="proofscript" id="proof148">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">intros</span> <span class="id">h</span> <span class="id">W</span> <span class="id">h</span>' <span class="id">DISJ</span> <span class="id">P</span>'<span class="id">h</span>'. <span class="tactic">apply</span> <span class="id">W</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="wand_imp_r">wand_imp_r</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">Q</span>',<br/>
&nbsp;&nbsp;(<span class="id">Q</span> --&gt;&gt; <span class="id">Q</span>') -&gt; (<span class="id">P</span> --* <span class="id">Q</span> --&gt;&gt; <span class="id">P</span> --* <span class="id">Q</span>').<br/>
<div class="toggleproof" onclick="toggleDisplay('proof149')">Proof.</div>
<div class="proofscript" id="proof149">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">intros</span> <span class="id">h</span> <span class="id">W</span> <span class="id">h</span>' <span class="id">DISJ</span> <span class="id">Ph</span>'. <span class="tactic">apply</span> <span class="id">H</span>; <span class="tactic">apply</span> <span class="id">W</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="wand_idem">wand_idem</a></span>: <span class="kwd">forall</span> <span class="id">P</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Separation.html#emp">emp</a></span> --&gt;&gt; <span class="id">P</span> --* <span class="id">P</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof150')">Proof.</div>
<div class="proofscript" id="proof150">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">P</span> <span class="id">h</span> <span class="id">E</span>. <span class="tactic">rewrite</span> <span class="id">E</span>. <span class="tactic">red</span>. <span class="tactic">intros</span>. <span class="tactic">rewrite</span> <span class="id"><a href="CDF.Separation.html#hunion_empty">hunion_empty</a></span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="wand_pure_l">wand_pure_l</a></span>: <span class="kwd">forall</span> (<span class="id">P</span>: <span class="kwd">Prop</span>) <span class="id">Q</span>,<br/>
&nbsp;&nbsp;<span class="id">P</span> -&gt; (<span class="id"><a href="CDF.Separation.html#pure">pure</a></span> <span class="id">P</span> --* <span class="id">Q</span>) = <span class="id">Q</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof151')">Proof.</div>
<div class="proofscript" id="proof151">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">PP</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Separation.html#assertion_extensionality">assertion_extensionality</a></span>. <span class="tactic">intros</span> <span class="id">h</span>; <span class="tactic">split</span>.<br/>
- <span class="tactic">intros</span> <span class="id">W</span>. <span class="tactic">rewrite</span> &lt;- <span class="id"><a href="CDF.Separation.html#hunion_empty">hunion_empty</a></span>, <span class="id"><a href="CDF.Separation.html#hunion_comm">hunion_comm</a></span> <span class="tactic">by</span> <span class="id">HDISJ</span>. <span class="tactic">apply</span> <span class="id">W</span>. <span class="id">HDISJ</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
- <span class="tactic">intros</span> <span class="id">Qh</span> <span class="id">h</span>' <span class="id">DISJ</span> (<span class="id">Ph</span>' &amp; <span class="id">E</span>). <span class="tactic">subst</span> <span class="id">h</span>'. <span class="tactic">rewrite</span> <span class="id"><a href="CDF.Separation.html#hunion_comm">hunion_comm</a></span>, <span class="id"><a href="CDF.Separation.html#hunion_empty">hunion_empty</a></span> <span class="tactic">by</span> <span class="id">HDISJ</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="wand_curry">wand_curry</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">R</span>,<br/>
&nbsp;&nbsp;(<span class="id">P</span> ** <span class="id">Q</span> --* <span class="id">R</span>) = (<span class="id">P</span> --* <span class="id">Q</span> --* <span class="id">R</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof152')">Proof.</div>
<div class="proofscript" id="proof152">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">apply</span> <span class="id"><a href="CDF.Separation.html#assertion_extensionality">assertion_extensionality</a></span>; <span class="tactic">intros</span> <span class="id">h</span>; <span class="tactic">split</span>.<br/>
- <span class="tactic">intros</span> <span class="id">W</span> <span class="id">h1</span> <span class="id">D1</span> <span class="id">Ph1</span> <span class="id">h2</span> <span class="id">D2</span> <span class="id">Qh2</span>. <span class="tactic">rewrite</span> <span class="id"><a href="CDF.Separation.html#hunion_assoc">hunion_assoc</a></span>. <span class="tactic">apply</span> <span class="id">W</span>. <span class="id">HDISJ</span>. <span class="id">exists</span> <span class="id">h1</span>, <span class="id">h2</span>; <span class="tactic">intuition</span> <span class="tactic">auto</span>. <span class="id">HDISJ</span>.<br/>
- <span class="tactic">intros</span> <span class="id">W</span> <span class="id">h</span>' <span class="id">D</span> (<span class="id">h1</span> &amp; <span class="id">h2</span> &amp; <span class="id">Ph1</span> &amp; <span class="id">Qh2</span> &amp; <span class="id">D12</span> &amp; <span class="id">U12</span>). <span class="tactic">subst</span> <span class="id">h</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id"><a href="CDF.Separation.html#hunion_assoc">hunion_assoc</a></span>. <span class="tactic">apply</span> <span class="id">W</span>. <span class="id">HDISJ</span>. <span class="tactic">auto</span>. <span class="id">HDISJ</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="wand_star">wand_star</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">Q</span> <span class="id">R</span>,<br/>
&nbsp;&nbsp;((<span class="id">P</span> --* <span class="id">Q</span>) ** <span class="id">R</span> ) --&gt;&gt; (<span class="id">P</span> --* (<span class="id">Q</span> ** <span class="id">R</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof153')">Proof.</div>
<div class="proofscript" id="proof153">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">intros</span> <span class="id">h</span> (<span class="id">h1</span> &amp; <span class="id">h2</span> &amp; <span class="id">W1</span> &amp; <span class="id">R2</span> &amp; <span class="id">D</span> &amp; <span class="id">U</span>). <span class="tactic">subst</span> <span class="id">h</span>. <span class="tactic">intros</span> <span class="id">h</span>' <span class="id">D</span>' <span class="id">Ph</span>'.<br/>
&nbsp;&nbsp;<span class="id">exists</span> (<span class="id"><a href="CDF.Separation.html#hunion">hunion</a></span> <span class="id">h1</span> <span class="id">h</span>'), <span class="id">h2</span>; <span class="tactic">intuition</span> <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">W1</span>; <span class="tactic">auto</span>. <span class="id">HDISJ</span>.<br/>
&nbsp;&nbsp;<span class="id">HDISJ</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> ! <span class="id"><a href="CDF.Separation.html#hunion_assoc">hunion_assoc</a></span>. <span class="tactic">f_equal</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Separation.html#hunion_comm">hunion_comm</a></span>. <span class="id">HDISJ</span>.<br/>
Qed.</div>
<br/>
<h2> Precise assertions </h2>
<br/>
<div class="doc">An assertion is precise if "it unambiguously carves out an area of the heap"
   (in the words of Gotsman, Berdine, Cook, 2011). </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="precise">precise</a></span> (<span class="id">P</span>: <span class="id"><a href="CDF.Separation.html#assertion">assertion</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">h1</span>' <span class="id">h2</span>',<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Separation.html#hdisjoint">hdisjoint</a></span> <span class="id">h1</span> <span class="id">h2</span> -&gt; <span class="id"><a href="CDF.Separation.html#hdisjoint">hdisjoint</a></span> <span class="id">h1</span>' <span class="id">h2</span>' -&gt; <span class="id"><a href="CDF.Separation.html#hunion">hunion</a></span> <span class="id">h1</span> <span class="id">h2</span> = <span class="id"><a href="CDF.Separation.html#hunion">hunion</a></span> <span class="id">h1</span>' <span class="id">h2</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">P</span> <span class="id">h1</span> -&gt; <span class="id">P</span> <span class="id">h1</span>' -&gt; <span class="id">h1</span> = <span class="id">h1</span>'.<br/>
<br/>
<div class="doc">A parameterized assertion is precise if, in addition, the parameter
   is uniquely determined as well. </div>
<br/>
<span class="kwd">Definition</span> <span class="id"><a name="param_precise">param_precise</a></span> {<span class="id">X</span>: <span class="kwd">Type</span>} (<span class="id">P</span>: <span class="id">X</span> -&gt; <span class="id"><a href="CDF.Separation.html#assertion">assertion</a></span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">x1</span> <span class="id">x2</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">h1</span>' <span class="id">h2</span>',<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Separation.html#hdisjoint">hdisjoint</a></span> <span class="id">h1</span> <span class="id">h2</span> -&gt; <span class="id"><a href="CDF.Separation.html#hdisjoint">hdisjoint</a></span> <span class="id">h1</span>' <span class="id">h2</span>' -&gt; <span class="id"><a href="CDF.Separation.html#hunion">hunion</a></span> <span class="id">h1</span> <span class="id">h2</span> = <span class="id"><a href="CDF.Separation.html#hunion">hunion</a></span> <span class="id">h1</span>' <span class="id">h2</span>' -&gt;<br/>
&nbsp;&nbsp;<span class="id">P</span> <span class="id">x1</span> <span class="id">h1</span> -&gt; <span class="id">P</span> <span class="id">x2</span> <span class="id">h1</span>' -&gt; <span class="id">x1</span> = <span class="id">x2</span> /\ <span class="id">h1</span> = <span class="id">h1</span>'.<br/>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="param_precise_precise">param_precise_precise</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">X</span>: <span class="kwd">Type</span>) (<span class="id">P</span>: <span class="id">X</span> -&gt; <span class="id"><a href="CDF.Separation.html#assertion">assertion</a></span>),<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Separation.html#param_precise">param_precise</a></span> <span class="id">P</span> -&gt; <span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="CDF.Separation.html#precise">precise</a></span> (<span class="id">P</span> <span class="id">x</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof154')">Proof.</div>
<div class="proofscript" id="proof154">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="id">edestruct</span> (<span class="id">H</span> <span class="id">x</span> <span class="id">x</span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">h1</span>' <span class="id">h2</span>'); <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Remark</span> <span class="id"><a name="precise_param_precise">precise_param_precise</a></span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">P</span>, <span class="id"><a href="CDF.Separation.html#precise">precise</a></span> <span class="id">P</span> -&gt; <span class="id"><a href="CDF.Separation.html#param_precise">param_precise</a></span> (<span class="kwd">fun</span> <span class="id">_</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#unit">unit</a></span> =&gt; <span class="id">P</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof155')">Proof.</div>
<div class="proofscript" id="proof155">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">split</span>. <span class="tactic">destruct</span> <span class="id">x1</span>, <span class="id">x2</span>; <span class="tactic">auto</span>. <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="pure_precise">pure_precise</a></span>: <span class="kwd">forall</span> <span class="id">P</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Separation.html#precise">precise</a></span> (<span class="id"><a href="CDF.Separation.html#pure">pure</a></span> <span class="id">P</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof156')">Proof.</div>
<div class="proofscript" id="proof156">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CDF.Separation.html#pure">pure</a></span>; <span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">H2</span>, <span class="id">H3</span>. <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="pure_param_precise">pure_param_precise</a></span>: <span class="kwd">forall</span> (<span class="id">X</span>: <span class="kwd">Type</span>) (<span class="id">P</span>: <span class="id">X</span> -&gt; <span class="kwd">Prop</span>),<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x1</span> <span class="id">x2</span>, <span class="id">P</span> <span class="id">x1</span> -&gt; <span class="id">P</span> <span class="id">x2</span> -&gt; <span class="id">x1</span> = <span class="id">x2</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Separation.html#param_precise">param_precise</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id"><a href="CDF.Separation.html#pure">pure</a></span> (<span class="id">P</span> <span class="id">x</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof157')">Proof.</div>
<div class="proofscript" id="proof157">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CDF.Separation.html#pure">pure</a></span>; <span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">H3</span>, <span class="id">H4</span>. <span class="tactic">split</span>. <span class="tactic">auto</span>. <span class="tactic">congruence</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="contains_param_precise">contains_param_precise</a></span>: <span class="kwd">forall</span> <span class="id">l</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Separation.html#param_precise">param_precise</a></span> (<span class="kwd">fun</span> <span class="id">v</span> =&gt; <span class="id"><a href="CDF.Separation.html#contains">contains</a></span> <span class="id">l</span> <span class="id">v</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof158')">Proof.</div>
<div class="proofscript" id="proof158">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CDF.Separation.html#contains">contains</a></span>; <span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">E</span>: <span class="id"><a href="CDF.Separation.html#hunion">hunion</a></span> <span class="id">h1</span> <span class="id">h2</span> <span class="id">l</span> = <span class="id"><a href="CDF.Separation.html#hunion">hunion</a></span> <span class="id">h1</span>' <span class="id">h2</span>' <span class="id">l</span>) <span class="tactic">by</span> <span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<span class="id">cbn</span> <span class="kwd">in</span> <span class="id">E</span>. <span class="tactic">subst</span> <span class="id">h1</span> <span class="id">h1</span>'. <span class="tactic">rewrite</span> ! <span class="id"><a href="CDF.Separation.html#hupdate_same">hupdate_same</a></span> <span class="kwd">in</span> <span class="id">E</span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> <span class="id">x2</span> <span class="kwd">with</span> <span class="id">x1</span> <span class="tactic">by</span> <span class="tactic">congruence</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="contains_precise">contains_precise</a></span>: <span class="kwd">forall</span> <span class="id">l</span> <span class="id">v</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Separation.html#precise">precise</a></span> (<span class="id"><a href="CDF.Separation.html#contains">contains</a></span> <span class="id">l</span> <span class="id">v</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof159')">Proof.</div>
<div class="proofscript" id="proof159">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Separation.html#param_precise_precise">param_precise_precise</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Separation.html#contains_param_precise">contains_param_precise</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="aexists_precise">aexists_precise</a></span>: <span class="kwd">forall</span> (<span class="id">X</span>: <span class="kwd">Type</span>) (<span class="id">P</span>: <span class="id">X</span> -&gt; <span class="id"><a href="CDF.Separation.html#assertion">assertion</a></span>),<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Separation.html#param_precise">param_precise</a></span> <span class="id">P</span> -&gt; <span class="id"><a href="CDF.Separation.html#precise">precise</a></span> (<span class="id"><a href="CDF.Separation.html#aexists">aexists</a></span> <span class="id">P</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof160')">Proof.</div>
<div class="proofscript" id="proof160">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">H3</span> <span class="kwd">as</span> (<span class="id">x1</span> &amp; <span class="id">P1</span>), <span class="id">H4</span> <span class="kwd">as</span> (<span class="id">x2</span> &amp; <span class="id">P2</span>).<br/>
&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="valid_precise">valid_precise</a></span>: <span class="kwd">forall</span> <span class="id">l</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Separation.html#precise">precise</a></span> (<span class="id"><a href="CDF.Separation.html#valid">valid</a></span> <span class="id">l</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof161')">Proof.</div>
<div class="proofscript" id="proof161">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Separation.html#aexists_precise">aexists_precise</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Separation.html#contains_param_precise">contains_param_precise</a></span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="sepconj_param_precise">sepconj_param_precise</a></span>: <span class="kwd">forall</span> (<span class="id">X</span>: <span class="kwd">Type</span>) (<span class="id">P</span> <span class="id">Q</span>: <span class="id">X</span> -&gt; <span class="id"><a href="CDF.Separation.html#assertion">assertion</a></span>),<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Separation.html#param_precise">param_precise</a></span> <span class="id">P</span> -&gt; (<span class="kwd">forall</span> <span class="id">x</span>, <span class="id"><a href="CDF.Separation.html#precise">precise</a></span> (<span class="id">Q</span> <span class="id">x</span>)) -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Separation.html#param_precise">param_precise</a></span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">P</span> <span class="id">x</span> ** <span class="id">Q</span> <span class="id">x</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof162')">Proof.</div>
<div class="proofscript" id="proof162">
&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">red</span>; <span class="tactic">intros</span>. <br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H4</span> <span class="kwd">as</span> (<span class="id">h3</span> &amp; <span class="id">h4</span> &amp; <span class="id">P3</span> &amp; <span class="id">Q4</span> &amp; <span class="id">D</span> &amp; <span class="id">E</span>). <br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H5</span> <span class="kwd">as</span> (<span class="id">h3</span>' &amp; <span class="id">h4</span>' &amp; <span class="id">P3</span>' &amp; <span class="id">Q4</span>' &amp; <span class="id">D</span>' &amp; <span class="id">E</span>').<br/>
&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">h1</span> <span class="id">h1</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">x1</span> = <span class="id">x2</span> /\ <span class="id">h3</span> = <span class="id">h3</span>'). <br/>
&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">H</span> <span class="kwd">with</span> (<span class="id"><a href="CDF.Separation.html#hunion">hunion</a></span> <span class="id">h4</span> <span class="id">h2</span>) (<span class="id"><a href="CDF.Separation.html#hunion">hunion</a></span> <span class="id">h4</span>' <span class="id">h2</span>'); <span class="tactic">auto</span>. <span class="id">HDISJ</span>. <span class="id">HDISJ</span>. <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- ! <span class="id"><a href="CDF.Separation.html#hunion_assoc">hunion_assoc</a></span>. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H4</span>. <span class="tactic">subst</span> <span class="id">x2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">h4</span> = <span class="id">h4</span>').<br/>
&nbsp;&nbsp;{ <span class="tactic">apply</span> (<span class="id">H0</span> <span class="id">x1</span>) <span class="kwd">with</span> (<span class="id"><a href="CDF.Separation.html#hunion">hunion</a></span> <span class="id">h3</span> <span class="id">h2</span>) (<span class="id"><a href="CDF.Separation.html#hunion">hunion</a></span> <span class="id">h3</span>' <span class="id">h2</span>'); <span class="tactic">auto</span>. <span class="id">HDISJ</span>. <span class="id">HDISJ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- ! <span class="id"><a href="CDF.Separation.html#hunion_assoc">hunion_assoc</a></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="CDF.Separation.html#hunion_comm">hunion_comm</a></span> <span class="id">h3</span>) <span class="tactic">by</span> <span class="id">HDISJ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="CDF.Separation.html#hunion_comm">hunion_comm</a></span> <span class="id">h3</span>') <span class="tactic">by</span> <span class="id">HDISJ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="sepconj_precise">sepconj_precise</a></span>: <span class="kwd">forall</span> <span class="id">P</span> <span class="id">Q</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Separation.html#precise">precise</a></span> <span class="id">P</span> -&gt; <span class="id"><a href="CDF.Separation.html#precise">precise</a></span> <span class="id">Q</span> -&gt; <span class="id"><a href="CDF.Separation.html#precise">precise</a></span> (<span class="id">P</span> ** <span class="id">Q</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof163')">Proof.</div>
<div class="proofscript" id="proof163">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id"><a href="CDF.Separation.html#param_precise">param_precise</a></span> (<span class="kwd">fun</span> <span class="id">_</span> : <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#unit">unit</a></span> =&gt; <span class="id">P</span> ** <span class="id">Q</span>)).<br/>
&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="CDF.Separation.html#sepconj_param_precise">sepconj_param_precise</a></span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Separation.html#precise_param_precise">precise_param_precise</a></span>; <span class="tactic">auto</span>. <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id"><a href="CDF.Separation.html#param_precise_precise">param_precise_precise</a></span> <span class="kwd">in</span> <span class="id">H1</span>. <span class="tactic">auto</span>. <span class="tactic">exact</span> <span class="id"><a href="http://coq.inria.fr/library/Coq.Init.Datatypes.html#tt">tt</a></span>.<br/>
Qed.</div>
<br/>
<div class="doc">Distributivity laws for precise assertions. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="sepconj_and_distr_1">sepconj_and_distr_1</a></span>: <span class="kwd">forall</span> <span class="id">P1</span> <span class="id">P2</span> <span class="id">Q</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Separation.html#aand">aand</a></span> <span class="id">P1</span> <span class="id">P2</span> ** <span class="id">Q</span> --&gt;&gt; <span class="id"><a href="CDF.Separation.html#aand">aand</a></span> (<span class="id">P1</span> ** <span class="id">Q</span>) (<span class="id">P2</span> ** <span class="id">Q</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof164')">Proof.</div>
<div class="proofscript" id="proof164">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">P1</span> <span class="id">P2</span> <span class="id">Q</span> <span class="id">h</span> (<span class="id">h1</span> &amp; <span class="id">h2</span> &amp; (<span class="id">P11</span> &amp; <span class="id">P21</span>) &amp; <span class="id">Q2</span> &amp; <span class="id">D</span> &amp; <span class="id">E</span>); <span class="tactic">split</span>; <span class="id">exists</span> <span class="id">h1</span>, <span class="id">h2</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="sepconj_and_distr_2">sepconj_and_distr_2</a></span>: <span class="kwd">forall</span> <span class="id">P1</span> <span class="id">P2</span> <span class="id">Q</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Separation.html#precise">precise</a></span> <span class="id">Q</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Separation.html#aand">aand</a></span> (<span class="id">P1</span> ** <span class="id">Q</span>) (<span class="id">P2</span> ** <span class="id">Q</span>) --&gt;&gt; <span class="id"><a href="CDF.Separation.html#aand">aand</a></span> <span class="id">P1</span> <span class="id">P2</span> ** <span class="id">Q</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof165')">Proof.</div>
<div class="proofscript" id="proof165">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">P1</span> <span class="id">P2</span> <span class="id">Q</span> <span class="id">PQ</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id"><a href="CDF.Separation.html#sepconj_comm">sepconj_comm</a></span> <span class="id">P1</span>), (<span class="id"><a href="CDF.Separation.html#sepconj_comm">sepconj_comm</a></span> <span class="id">P2</span>). <br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">h</span> ((<span class="id">h1</span> &amp; <span class="id">h2</span> &amp; <span class="id">Q1</span> &amp; <span class="id">P12</span> &amp; <span class="id">D</span> &amp; <span class="id">E</span>) &amp; (<span class="id">h1</span>' &amp; <span class="id">h2</span>' &amp; <span class="id">Q1</span>' &amp; <span class="id">P22</span> &amp; <span class="id">D</span>' &amp; <span class="id">E</span>')).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">h1</span> = <span class="id">h1</span>').<br/>
&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">PQ</span> <span class="kwd">with</span> <span class="id">h2</span> <span class="id">h2</span>'; <span class="tactic">auto</span>. <span class="id">HDISJ</span>. <span class="id">HDISJ</span>. <span class="tactic">congruence</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">h1</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">h2</span> = <span class="id">h2</span>').<br/>
&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id"><a href="CDF.Separation.html#hunion_invert_r">hunion_invert_r</a></span> <span class="kwd">with</span> <span class="id">h1</span>; <span class="tactic">auto</span>; <span class="tactic">congruence</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">h2</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id"><a href="CDF.Separation.html#aand">aand</a></span>; <span class="id">exists</span> <span class="id">h2</span>, <span class="id">h1</span>; <span class="tactic">intuition</span> <span class="tactic">auto</span>. <span class="id">HDISJ</span>. <span class="tactic">rewrite</span> <span class="id"><a href="CDF.Separation.html#hunion_comm">hunion_comm</a></span> <span class="tactic">by</span> <span class="id">HDISJ</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<div class="doc">Self-conjunction law for precise assertions. </div>
<br/>
<span class="kwd">Lemma</span> <span class="id"><a name="sepconj_self">sepconj_self</a></span>: <span class="kwd">forall</span> <span class="id">P</span>,<br/>
&nbsp;&nbsp;<span class="id"><a href="CDF.Separation.html#precise">precise</a></span> <span class="id">P</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">P</span> ** <span class="id">P</span> --&gt;&gt; <span class="id">P</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof166')">Proof.</div>
<div class="proofscript" id="proof166">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">intros</span> <span class="id">h</span> (<span class="id">h1</span> &amp; <span class="id">h2</span> &amp; <span class="id">P1</span> &amp; <span class="id">P2</span> &amp; <span class="id">D</span> &amp; <span class="id">E</span>).<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">h1</span> = <span class="id">h2</span>). { <span class="tactic">apply</span> <span class="id">H</span> <span class="kwd">with</span> <span class="id">h2</span> <span class="id">h1</span>; <span class="tactic">auto</span>. <span class="id">HDISJ</span>. <span class="tactic">apply</span> <span class="id"><a href="CDF.Separation.html#hunion_comm">hunion_comm</a></span>; <span class="id">HDISJ</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">subst</span> <span class="id">h2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">h</span> = <span class="id">h1</span>). { <span class="tactic">apply</span> <span class="id"><a href="CDF.Separation.html#heap_extensionality">heap_extensionality</a></span>; <span class="tactic">intros</span> <span class="id">l</span>. <span class="tactic">rewrite</span> <span class="id">E</span>; <span class="id">cbn</span>. <span class="tactic">destruct</span> (<span class="id">h1</span> <span class="id">l</span>); <span class="tactic">auto</span>. }<br/>
&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
Qed.</div>

</div>
<div class="footer"><hr/>Generated by <a href="https://github.com/xavierleroy/coq2html/">coq2html</a></div>
</body>
</html>
